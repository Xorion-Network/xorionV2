<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>XORION Private sale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#000000;--bg-card:rgba(8,8,8,.98);--bg-soft:rgba(15,15,15,.9);
      --border-soft:rgba(147,51,234,.25);--accent:#E600A9;--accent2:#FF4DC4;
      --accent-soft:rgba(147,51,234,.15);--txt:#ffffff;--muted:#a3a3a3;--glow:rgba(147,51,234,.65);
      --purple-light:6A00FF;--purple-dark:#FFA6E8;
      --nav-h:70px;--radius:1.1rem;--shadow:0 24px 80px rgba(0,0,0,.85)
    }

    *,*:before,*:after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",sans-serif;
      background:#000000;
      color:var(--txt);-webkit-font-smoothing:antialiased;
    }

    a{text-decoration:none;color:inherit}

    /* Animated Background Effects */
    .bg-effects {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .moving-bg-image {
      position: relative;
      width: 60%;
      height: 69%;
      top: -10%;
      left: -10%;
      background: radial-gradient(circle, rgba(147,51,234,0.04) 0%, transparent 70%);
      opacity: 0.6;
      animation: moveCircuit 30s linear infinite;
    }

    .grid-overlay {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(147,51,234,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(147,51,234,.06) 1px, transparent 1px);
      background-size: 60px 60px;
      opacity: .3;
      mix-blend-mode: soft-light;
    }

    @keyframes moveCircuit {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-50px, -30px) rotate(90deg); }
      50% { transform: translate(-100px, -60px) rotate(180deg); }
      75% { transform: translate(-50px, -90px) rotate(270deg); }
      100% { transform: translate(0, 0) rotate(360deg); }
    }

    .light-beam {
      position: absolute;
      width: 2px;
      height: 200px;
      background: linear-gradient(180deg, transparent, var(--accent), transparent);
      border-radius: 2px;
      opacity: 0;
      animation: lightBeam 8s infinite linear;
      box-shadow: 0 0 20px var(--glow);
    }
    .light-beam:nth-child(1) { left: 10%; animation-delay: 0s; }
    .light-beam:nth-child(2) { left: 25%; animation-delay: 2s; height: 150px; }
    .light-beam:nth-child(3) { left: 40%; animation-delay: 4s; height: 180px; }
    .light-beam:nth-child(4) { left: 65%; animation-delay: 6s; height: 120px; }
    .light-beam:nth-child(5) { left: 80%; animation-delay: 1s; height: 160px; }
    .light-beam:nth-child(6) { left: 90%; animation-delay: 3s; height: 140px; }

    @keyframes lightBeam {
      0% { transform: translateY(-100vh); opacity: 0; }
      10% { opacity: 0.8; }
      90% { opacity: 0.8; }
      100% { transform: translateY(100vh); opacity: 0; }
    }

    .floating-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0;
      animation: floatParticle 12s infinite linear;
      box-shadow: 0 0 10px var(--glow);
    }
    .floating-particle:nth-child(7) { left: 20%; animation-delay: 0s; }
    .floating-particle:nth-child(8) { left: 50%; animation-delay: 4s; }
    .floating-particle:nth-child(9) { left: 70%; animation-delay: 8s; }

    @keyframes floatParticle {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
    }

    .pulse-ring {
      position: absolute;
      top: 20%;
      right: 10%;
      width: 100px;
      height: 100px;
      border: 2px solid var(--accent);
      border-radius: 50%;
      opacity: 0;
      animation: pulseRing 6s infinite ease-in-out;
    }
    .pulse-ring:nth-child(10) { animation-delay: 0s; }
    .pulse-ring:nth-child(11) { animation-delay: 2s; top: 60%; left: 5%; }

    @keyframes pulseRing {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.2); opacity: 0.6; }
      100% { transform: scale(2); opacity: 0; }
    }

    /* Nav */
    header.nav{
      position:fixed;inset:0 0 auto 0;height:var(--nav-h);z-index:40;
      backdrop-filter:blur(18px);
      background-color: transparent;
      border-bottom:1px solid rgba(255,255,255,.08);
    }

    .nav-inner{
      max-width:1120px;margin:0 auto;padding:.5rem 1.5rem;
      display:flex;align-items:center;justify-content:space-between;
    }
    .brand{display:flex;align-items:center;gap:.55rem;font-weight:600;font-size:.82rem;letter-spacing:.16em;text-transform:uppercase}
    .logo-orb{
      width:26px;height:26px;border-radius:999px;
      background:linear-gradient(135deg, var(--accent), var(--purple-light));
      box-shadow:0 0 20px rgba(147,51,234,.6);position:relative;overflow:hidden;
    }
    .logo-orb::after{
      content:"";position:absolute;inset:6px;border-radius:inherit;
      background:#000000;
    }

    .nav-links{display:flex;align-items:center;gap:1rem;font-size:.78rem}
    .nav-links a{color:var(--muted);transition:color .2s}
    .nav-links a:hover{color:var(--txt)}
    .btn,.btn-outline,.btn-ghost{
      border-radius:999px;font-size:.8rem;font-weight:500;letter-spacing:.03em;
      padding:.45rem 1.1rem;border:1px solid transparent;cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:.35rem;
      background:transparent;color:var(--txt);
      transition:background .18s,border-color .18s,transform .12s,box-shadow .2s,color .15s;
    }
    .btn{
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      color:#ffffff;
      border-color:var(--accent);
      box-shadow:0 16px 40px rgba(147,51,234,.5);
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 22px 54px rgba(147,51,234,.7)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .btn-outline{border-color:rgba(147,51,234,.5);background:rgba(0,0,0,.9)}
    .btn-outline:hover{border-color:var(--accent);background:rgba(147,51,234,.1)}
    .btn-ghost{border-color:rgba(147,51,234,.3);background:rgba(0,0,0,.85)}
    .btn-ghost:hover{border-color:var(--accent);background:rgba(147,51,234,.05)}

    .btn-small{padding:.3rem .85rem;font-size:.76rem}
    .pill-tag{
      font-size:.68rem;padding:.12rem .45rem;border-radius:999px;
      border:1px solid rgba(147,51,234,.4);background:rgba(0,0,0,.9);color:var(--purple-light);
    }

    /* Mobile Menu */
    .mobile-menu-btn{display:none;background:none;border:none;color:var(--txt);cursor:pointer;padding:0.5rem}
    @media(max-width:768px){
      .nav-links{display:none}
      .mobile-menu-btn{display:block}
      .nav-links.mobile-open{
        display:flex;flex-direction:column;position:fixed;top:var(--nav-h);left:0;right:0;
        background:rgba(0,0,0,.98);border-bottom:1px solid rgba(255,255,255,.08);
        padding:1rem 1.5rem;gap:1.2rem;backdrop-filter:blur(18px);
      }
    }

    /* Section spacing */
    .section{padding:6rem 1.5rem;position:relative}
    .section:first-of-type{padding-top:calc(var(--nav-h) + 4rem)}
    .inner{max-width:1120px;margin:0 auto}
    
    .hero-badge{display:flex;align-items:center;gap:.5rem;margin-bottom:1.2rem;font-size:.82rem;color:var(--muted)}
    .kicker{font-size:.72rem;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin-bottom:.8rem}
    .title-lg{font-size:clamp(2rem,5vw,3.2rem);line-height:1.15;margin:0 0 1.2rem;font-weight:700}
    .subtitle{font-size:1rem;line-height:1.6;color:var(--muted);margin-bottom:1.8rem;max-width:540px}

    .hero-grid{display:grid;grid-template-columns:1fr 1fr;gap:4rem;align-items:center}
    @media(max-width:900px){.hero-grid{grid-template-columns:1fr;gap:3rem}}

    .hero-stat-row{display:flex;flex-wrap:wrap;gap:.7rem;margin-top:1.2rem;font-size:.76rem}
    .stat-chip{
      padding:.35rem .75rem;border-radius:999px;border:1px solid rgba(147,51,234,.3);
      background:rgba(0,0,0,.9);color:var(--muted);
    }
    .stat-chip strong{color:var(--purple-light)}
    .hero-orbit-wrap{display:flex;justify-content:center}
    .hero-orbit{
      width:260px;height:260px;border-radius:999px;position:relative;
      background:#000000;
      box-shadow:0 0 80px rgba(0,0,0,.9),0 0 40px rgba(255,255,255,.12);
      overflow:hidden;
    }
    .ring{
      position:absolute;border-radius:999px;
      inset:12px;
      border:1px dotted rgba(147,51,234,.8);
      background:transparent;
      animation:spin 26s linear infinite;
    }
    .ring-large{
      position:absolute;border-radius:999px;
      inset:-8px;
      border:1px dotted rgba(147,51,234,.4);
      background:transparent;
      animation:spin-rev 38s linear infinite;
    }
    .core{
      position:absolute;inset:64px;border-radius:999px;
      background:radial-gradient(circle,#E600A9 0,#000000 70%);
      box-shadow:0 0 50px rgba(147,51,234,.4);
    }

    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes spin-rev{to{transform:rotate(-360deg)}}
    
    /* Presale card */
    .presale-grid{
      display:grid;grid-template-columns:minmax(0,1.2fr) minmax(0,1.1fr);gap:3rem;align-items:flex-start;
    }
    @media(max-width:900px){.presale-grid{grid-template-columns:1fr}}
    
    .card{
      background:var(--bg-card);border-radius:var(--radius);
      border:1px solid var(--border-soft);box-shadow:var(--shadow);
      padding:1.4rem 1.5rem 1.5rem;position:relative;overflow:hidden;
      transition:transform .18s ease-out,border-color .18s ease-out,box-shadow .18s ease-out;
    }
    .card:hover{
      transform:translateY(-4px);
      border-color:rgba(255,255,255,.3);
      box-shadow:0 28px 90px rgba(0,0,0,.95);
    }

    .card::before{
      content:"";position:absolute;inset:-40% -40% auto auto;
      background:radial-gradient(circle at top,#E600A9 0,transparent 55%);
      opacity:.08;pointer-events:none;
    }

    .card-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;font-size:.86rem;flex-wrap:wrap;gap:.5rem}
    .chip-soft{
      padding:.18rem .6rem;border-radius:999px;
      background:rgba(0,0,0,.98);border:1px solid rgba(147,51,234,.45);font-size:.7rem;
      color:var(--purple-light);
    }

    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem;gap:.8rem;flex-wrap:wrap}
    .row-col{display:flex;align-items:center;gap:.6rem}
    .selector{
      padding:.4rem .8rem;border-radius:999px;border:1px solid rgba(147,51,234,.4);
      background:rgba(0,0,0,.9);color:var(--txt);cursor:pointer;font-size:.82rem;
      display:flex;align-items:center;gap:.4rem;transition:border-color .2s;
    }
    .selector:hover{border-color:var(--accent)}
    .balance{font-size:.76rem;color:var(--muted)}

    .field{margin:1.2rem 0}
    .field label{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.8rem;flex-wrap:wrap;gap:.3rem}
    .field input{
      width:100%;padding:.75rem 1rem;border-radius:.75rem;
      border:1px solid rgba(147,51,234,.3);background:rgba(0,0,0,.95);
      color:var(--txt);font-size:.9rem;transition:border-color .2s;
    }
    .field input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(147,51,234,.1)}
    .field-input-row{
      display:flex;align-items:center;gap:.5rem;
    }
    #xor-estimate{margin-top:.35rem;}

    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:.8rem}
    @media(max-width:480px){.info-grid{grid-template-columns:1fr}}

    .pill{
      border-radius:.9rem;padding:.6rem .75rem;
      background:rgba(0,0,0,.98);border:1px solid rgba(147,51,234,.35);color:var(--muted);
      font-size:.8rem;line-height:1.5;
    }
    .pill strong{color:var(--purple-light);font-weight:500;display:block;margin-bottom:.2rem}
    
    .countdown{
      margin-top:1.2rem;padding:.6rem .9rem;border-radius:.85rem;
      background:rgba(0,0,0,.95);border:1px solid rgba(147,51,234,.5);
      display:flex;align-items:center;justify-content:space-between;gap:.9rem;font-size:.82rem;
      flex-wrap:wrap;
    }
    .countdown span.num{font-weight:600;color:var(--purple-light)}

    .btn-row{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:1.2rem}
    .claim-tag{
      font-size:.65rem;margin-left:.4rem;padding:.08rem .4rem;border-radius:999px;
      background:rgba(0,0,0,.95);border:1px solid rgba(147,51,234,.4);color:var(--purple-light);
    }
    .note{margin-top:.9rem;font-size:.72rem;color:var(--muted);line-height:1.5}
    
    /* Sale structure */
    .sale-card{
      max-width:860px;margin:0 auto;
      background:var(--bg-card);border-radius:1.25rem;
      border:1px solid var(--border-soft);box-shadow:var(--shadow);padding:1.6rem 1.7rem 1.9rem;
      position:relative;overflow:hidden;
      transition:transform .18s ease-out,border-color .18s ease-out,box-shadow .18s ease-out;
    }
    .sale-card:hover{
      transform:translateY(-4px);
      border-color:rgba(255,255,255,.28);
      box-shadow:0 26px 80px rgba(0,0,0,.95);
    }

    .sale-card::before{
      content:"";position:absolute;inset:auto -20% -60%;height:240px;
      background:radial-gradient(circle at bottom,#E600A9 0,transparent 60%);
      opacity:.07;pointer-events:none;
    }

    .sale-title{text-align:center;font-size:1.4rem;margin:0 0 1rem}
    .sale-sub{font-size:.8rem;color:var(--muted);text-align:center;margin-bottom:1.6rem}
    .sale-table{width:100%;border-collapse:collapse;position:relative;z-index:1}
    .sale-table tr+tr td{border-top:1px solid rgba(148,163,184,.32)}
    .sale-table td{padding:.7rem .4rem;vertical-align:top;font-size:.82rem}
    .sale-label{color:var(--purple-light);font-weight:500;width:32%;padding-right:1.2rem}
    .sale-value{color:var(--txt)}
    .sale-value a{color:var(--purple-light);text-decoration:underline dotted}
    @media(max-width:640px){
      .sale-table,.sale-table tbody,.sale-table tr,.sale-table td{display:block;width:100%}
      .sale-table tr+tr{margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(148,163,184,.32)}
      .sale-label{margin-bottom:.18rem}
    }

    /* Footer/CTA */
    .cta-card{
      max-width:860px;margin:0 auto;
      background:rgba(0,0,0,.96);border-radius:1.2rem;
      border:1px solid rgba(147,51,234,.3);padding:1.6rem 1.7rem 1.8rem;
      display:flex;flex-wrap:wrap;gap:1.2rem;align-items:center;justify-content:space-between;font-size:.85rem;
    }

    .cta-badge{font-size:.72rem;color:var(--muted);margin-bottom:.3rem}
    .cta-title{font-size:1.2rem;margin:0 0 .2rem}
    .cta-actions{display:flex;flex-wrap:wrap;gap:.75rem}
    
    /* Modals */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      z-index:60;
    }
    .modal.open{display:flex}
    .modal-backdrop{
      position:absolute;inset:0;background:rgba(0,0,0,.9);
      opacity:.94;backdrop-filter:blur(12px);
    }

    .modal-panel{
      position:relative;z-index:1;max-width:360px;width:90%;
      background:rgba(0,0,0,.98);border-radius:1rem;
      border:1px solid rgba(147,51,234,.5);box-shadow:var(--shadow);
      padding:1.2rem 1.3rem 1.3rem;font-size:.85rem;
    }

    .modal-title{font-size:1rem;margin:0 0 .6rem}
    .asset-option{
      width:100%;margin-top:.45rem;padding:.55rem .8rem;border-radius:.75rem;
      border:1px solid rgba(147,51,234,.4);background:rgba(0,0,0,.95);
      display:flex;justify-content:space-between;align-items:center;font-size:.82rem;cursor:pointer;
      transition:border-color .2s,background .2s;
      color: white;
    }
    .asset-option span.symbol{font-weight:600;color:var(--purple-light)}
    .asset-option:hover{border-color:var(--accent);background:rgba(147,51,234,.05)}

    .modal-footer{margin-top:.9rem;display:flex;justify-content:flex-end}
    
    /* Progress modal */
    .steps{list-style:none;margin:.6rem 0 0;padding:0;font-size:.8rem}
    .steps li{
      padding:.35rem .65rem;border-radius:.55rem;margin-top:.18rem;
      display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.95);
      border:1px solid rgba(147,51,234,.3);color:var(--muted);
    }

    .steps li .dot{
      width:10px;height:10px;border-radius:999px;border:2px solid rgba(147,51,234,.5);
      background:transparent;flex-shrink:0;
    }
    .steps li.active{border-color:var(--accent);color:#e5e7eb}
    .steps li.active .dot{border-color:transparent;background:var(--accent)}
    .steps li.done{border-style:dashed;border-color:var(--purple-light);color:#f5f5f5}
    .steps li.done .dot{background:var(--purple-light);border-color:var(--purple-light)}
    .steps li.error{border-color:rgba(147,51,234,.6);color:#f5f5f5}
    .steps li.error .dot{background:var(--accent);border-color:var(--accent)}

    /* Toasts */
    #toast-container{
      position:fixed;bottom:1.3rem;right:1.3rem;display:flex;flex-direction:column;
      gap:.55rem;z-index:70;pointer-events:none;
    }
    .toast{
      min-width:230px;max-width:280px;padding:.6rem .8rem;border-radius:.9rem;
      background:rgba(0,0,0,.92);border:1px solid rgba(147,51,234,.5);
      box-shadow:0 18px 50px rgba(0,0,0,1);backdrop-filter:blur(14px);
      font-size:.78rem;display:flex;align-items:flex-start;gap:.55rem;pointer-events:auto;
      opacity:1;transition:opacity .3s,transform .3s;
    }

    .toast-icon{width:9px;height:9px;border-radius:999px;margin-top:.18rem;flex-shrink:0}
    .toast-title{font-weight:500;font-size:.8rem;margin-bottom:.08rem}
    .toast.success{border-color:var(--accent)}
    .toast.success .toast-icon{background:var(--purple-light)}
    .toast.error{border-color:rgba(147,51,234,.7)}
    .toast.error .toast-icon{background:var(--accent)}

    @media(max-width:640px){
      #toast-container{left:50%;right:auto;transform:translateX(-50%);bottom:1.1rem}
      .section{padding:4rem 1rem}
      .title-lg{font-size:1.8rem}
      .btn-row{width:100%}
      .btn-row .btn,.btn-row .btn-outline{flex:1;min-width:120px}
    }
    
    /* Utility */
    .muted{color:var(--muted);font-size:.78rem}
    
        * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }


    .features-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .grid-spacer {
      margin-bottom: 2.5rem;
    }

    .feature-card {
      position: relative;
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(147, 51, 234, 0.3);
      border-radius: 1.5rem;
      padding: 0;
      min-height: 280px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    @media (max-width: 640px) {
      .feature-card {
        min-height: 240px;
        border-radius: 1rem;
      }
    }

    .feature-card:hover {
      transform: translateY(-4px);
      border-color: rgba(147, 51, 234, 0.6);
      box-shadow: 0 20px 60px rgba(147, 51, 234, 0.2);
    }

    .feature-image {
      width: 100%;
      height: 140px;
      object-fit: cover;
      display: block;
    }

    @media (max-width: 640px) {
      .feature-image {
        height: 110px;
      }
    }

    /* Placeholder patterns for images */
    .feature-image.build {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%),
                  repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(147, 51, 234, 0.1) 10px, rgba(147, 51, 234, 0.1) 20px);
      background-blend-mode: overlay;
    }

    .feature-image.contribute {
      background: linear-gradient(135deg, #0f3460 0%, #16213e 50%, #1a1a2e 100%),
                  repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(168, 85, 247, 0.1) 10px, rgba(168, 85, 247, 0.1) 20px);
      background-blend-mode: overlay;
    }

    .feature-image.compete {
      background: linear-gradient(135deg, #16213e 0%, #0f3460 50%, #1a1a2e 100%),
                  radial-gradient(circle at 30% 50%, rgba(147, 51, 234, 0.15) 0%, transparent 50%);
      background-blend-mode: overlay;
    }

    .feature-image.token {
      background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 50%, #16213e 100%),
                  repeating-linear-gradient(90deg, transparent, transparent 15px, rgba(192, 132, 252, 0.1) 15px, rgba(192, 132, 252, 0.1) 30px);
      background-blend-mode: overlay;
    }

    .feature-content {
      padding: 1.2rem 1.3rem 1.4rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    @media (max-width: 640px) {
      .feature-content {
        padding: 1rem 1rem 1.2rem;
      }
    }

    .feature-text {
      margin-bottom: 1rem;
    }

    .feature-title {
      font-size: 1.75rem;
      font-weight: 300;
      margin-bottom: 0.4rem;
      letter-spacing: -0.02em;
    }

    @media (max-width: 640px) {
      .feature-title {
        font-size: 1.4rem;
        margin-bottom: 0.3rem;
      }
    }

    .feature-description {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.75);
      line-height: 1.4;
    }

    @media (max-width: 640px) {
      .feature-description {
        font-size: 0.8rem;
        line-height: 1.35;
      }
    }

    .feature-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.6rem 1.2rem;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      align-self: flex-start;
    }

    @media (max-width: 640px) {
      .feature-btn {
        padding: 0.5rem 1rem;
        font-size: 0.7rem;
      }
    }

    .feature-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 255, 255, 0.3);
    }

    .feature-btn svg {
      width: 14px;
      height: 14px;
    }

    @media (max-width: 640px) {
      .feature-btn svg {
        width: 12px;
        height: 12px;
      }
    }

    /* Footer Section */
    .footer-divider {
      border: none;
      border-top: 1px dashed rgba(147, 51, 234, 0.3);
      margin: 3rem 0;
    }

    .footer-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 3rem;
      text-align: center;
    }

    @media (min-width: 768px) {
      .footer-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .footer-column h3 {
      font-size: 1.5rem;
      font-weight: 300;
      margin-bottom: 1.5rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .footer-links {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .footer-links a {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 1.05rem;
      transition: color 0.2s ease;
    }

    .footer-links a:hover {
      color: #FF4DC4;
    }

    .social-icons {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }

    .social-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(147, 51, 234, 0.3);
      border-radius: 12px;
      color: #fff;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .social-icon:hover {
      background: rgba(147, 51, 234, 0.2);
      border-color: #FF4DC4;
      transform: translateY(-2px);
    }

    .social-icon svg {
      width: 24px;
      height: 24px;
    }

    /* Responsive adjustments */
    @media (max-width: 640px) {
      body {
        padding: 2rem 1rem;
      }

      .features-grid {
        gap: 1rem;
      }

      .grid-spacer {
        margin-bottom: 1.5rem;
      }

      .footer-grid {
        gap: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-effects">
    <div class="moving-bg-image"></div>
    <div class="grid-overlay"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="floating-particle"></div>
    <div class="floating-particle"></div>
    <div class="floating-particle"></div>
    <div class="pulse-ring"></div>
    <div class="pulse-ring"></div>
  </div>
  
<header class="nav">
  <div class="nav-inner">
    <div class="brand">
      <div class=""><img src="https://explorer.xorion.network/logo.svg" width="60px" height="60px"/></div>
      <span><h2>XORION</h2></span>
    </div>
    <button class="mobile-menu-btn" id="mobile-menu-toggle">☰</button>
    <div class="nav-links" id="nav-links">
      <a href="#hero">Overview</a>
      <a href="#presale">Private Sale</a>
      <a href="#sale-structure">Sale Structure</a>
      <a href="#more">Docs</a>
      <button class="btn-small btn-outline" id="nav-connect">Connect Wallet</button>
    </div>
  </div>
</header>

<main>
  <!-- Hero (Section 1) -->
  <section id="hero" class="section hero">
    <div class="inner">
      <div class="hero-grid">
        <div>
          <div class="hero-badge">
            <span class="pill-tag">New</span>
            <span>On‑chain liquidity layer for Web3</span>
          </div>
          <div class="kicker">XORION PRIVATE SALE</div>
          <h1 class="title-lg">Explore the Blockchain
Effortlessly.</h1>
          <p class="subtitle">
            Participate in the XORION private sale and be early to a cross‑chain execution, Your comprehensive portal for real-time network statistics, staking insights, and transaction tracking..
          </p>
          <div class="btn-row">
            <button class="btn" onclick="document.querySelector('#presale').scrollIntoView({behavior:'smooth'})">
              Join private sale
            </button>
            <button class="btn-ghost" onclick="document.querySelector('#sale-structure').scrollIntoView({behavior:'smooth'})">
              View sale structure
            </button>
          </div>
          <div class="hero-stat-row">
            <span class="stat-chip">Chain: <strong>BNB Smart Chain</strong></span>
            <span class="stat-chip">Assets: <strong>BNB, USDT</strong></span>
            <span class="stat-chip">Listing: <strong>$0.06</strong></span>
          </div>
        </div>
        <div class="hero-orbit-wrap">
          <center><img src="live.png" width="95%"/></center>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Presale (Section 2) -->
  <section id="presale" class="section">
    <div class="inner">
      <div class="presale-grid">
        <div>
          <div class="kicker">SALE PARTICIPATION</div>
          <h2 class="title-lg">XORION Private sale, participate now.</h2>
          <p class="subtitle">
            Connect your wallet, choose your asset, and secure allocation into XORION. The private sale settles on BNB with support for BNB and USDT payments.
          </p>
          <p class="muted">
            Progress updates: connect wallet → switch to BNB chain → execute ERC‑20 transfer to the sale contract → confirm successful participation → wait for distribution and claim updates.
          </p>
        </div>
        <div class="card">
          <div class="card-head">
            <span>XORION Private sale</span>
            <span class="chip-soft">Live • Phase 1</span>
          </div>
          <div class="row">
            <div class="row-col">
              <span class="muted">Pay with</span>
              <button class="selector" id="asset-trigger">
                <span class="symbol" id="asset-symbol">USDT</span>
                <span>▼</span>
              </button>
            </div>
            <div class="row-col">
              <span class="muted">Wallet</span>
              <button class="btn-small btn-outline" id="connect-main">Connect</button>
            </div>
          </div>
          <div class="row">
            <span class="balance" id="balance-text">Balance: --</span>
            <span class="balance">Chain: BNB Smart Chain</span>
          </div>
          <div class="field">
            <label>
              <span>Amount in <span id="asset-label">USDT</span></span>
              <span class="muted">Min 20 USDT / 0.024 BNB</span>
            </label>
            <div class="field-input-row">
              <input type="number" id="amount-input" min="0" step="0.0001" placeholder="Enter amount" />
              <button type="button" class="btn-small btn-outline" id="max-btn">Max</button>
            </div>
            <p class="muted" id="xor-estimate"></p>
          </div>
          <div class="info-grid">
            <div class="pill">
              <strong>Token price</strong>
              1 XORION = <span class="muted">$0.035</span>
            </div>
            <div class="pill">
              <strong>Listing price</strong>
              <span class="muted">$0.06</span> on launch
            </div>
          </div>
          <div class="info-grid">
            <div class="pill">
              <strong>Soft cap</strong>
              <span class="muted">$10,000</span>
            </div>
            <div class="pill">
              <strong>Hard cap</strong>
              <span class="muted">$50,000</span>
            </div>
          </div>
          <div class="countdown">
            <span class="muted">Presale ends in</span>
            <span><span class="num" id="cd-days">--</span> d</span>
            <span><span class="num" id="cd-hours">--</span> h</span>
            <span><span class="num" id="cd-mins">--</span> m</span>
            <span><span class="num" id="cd-secs">--</span> s</span>
          </div>
          <div class="btn-row">
            <button class="btn" id="buy-btn">Buy now</button>
            <button class="btn-outline" id="claim-btn" disabled>
              Claim
              <span class="claim-tag">Coming soon</span>
            </button>
          </div>
          <p class="note">
            Transactions are executed from your connected wallet on BNB Smart Chain.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Sale Structure (Section 3) -->
  <section id="sale-structure" class="section">
    <div class="inner">
      <div class="sale-card">
        <h2 class="sale-title">Sale Structure</h2>
        <p class="sale-sub">
          Live blockchain metrics, block times, and network health at a glance.
        </p>
        <table class="sale-table">
          <tbody>
          <tr>
            <td class="sale-label">Sale Date</td>
            <td class="sale-value">December 16, 2025 at 11:00 UTC – December 18, 2025 at 14:00 UTC</td>
          </tr>
          <tr>
            <td class="sale-label">Token Price</td>
            <td class="sale-value">$0.035 (Presale) / $0.06 (Listing)</td>
          </tr>
          <tr>
            <td class="sale-label">Total Supply</td>
            <td class="sale-value">1,000,000,000 XORION</td>
          </tr>
          <tr>
            <td class="sale-label">Allocated Supply for Sale</td>
            <td class="sale-value">20,000,000 XORION (2% of total token supply)</td>
          </tr>
          <tr>
            <td class="sale-label">Unlock Schedule</td>
            <td class="sale-value">20% TGE + 5 Months vesting</td>
          </tr>
          <tr>
            <td class="sale-label">Purchase Limits</td>
            <td class="sale-value">Minimum: $20 USDT / 0.024 BNB</td>
          </tr>
          <tr>
            <td class="sale-label">Payment Methods</td>
            <td class="sale-value">BNB, USDT (BEP-20 on BNB Smart Chain)</td>
          </tr>
          <tr>
            <td class="sale-label">Eligible Participants</td>
            <td class="sale-value">
              EU excluded only, all other countries can participate in the sale.
            </td>
          </tr>
          <tr>
            <td class="sale-label">Sale FAQ</td>
            <td class="sale-value"><a href="#" tabindex="0">XORION FAQ</a></td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>


  <section class="features-section">
    <!-- First Grid: Build & Contribute -->
    <div class="features-grid">
      <!-- Build Card -->
      <div class="feature-card">
        <img src="https://images.unsplash.com/photo-1639322537228-f710d846310a?w=800&h=400&fit=crop" 
             alt="Build" 
             class="feature-image build">
        <div class="feature-content">
          <div class="feature-text">
            <h2 class="feature-title">Advanced Staking</h2>
            <p class="feature-description">Delegate, claim rewards, and compare validators with ease.</p>
          </div>
          <a href="https://explorer.xorion.network/explorer"> <button class="feature-btn" onclick="window.location.href='#contribute'">
            Visit
          </button></a>
        </div>
      </div>

      <!-- Contribute Card -->
      <div class="feature-card">
        <img src="https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=800&h=400&fit=crop" 
             alt="Contribute" 
             class="feature-image contribute">
        <div class="feature-content">
          <div class="feature-text">
            <h2 class="feature-title">Transaction Explorer</h2>
            <p class="feature-description">Track every transaction and block with powerful search and filters.</p>
          </div>
         <a href="https://scan.xorion.network"> <button class="feature-btn" onclick="window.location.href='#contribute'">
            Visit
          </button></a>
        </div>
      </div>
    </div>

    <div class="grid-spacer"></div>

    <!-- Second Grid: Compete & $AI -->
    <div class="features-grid">
      <!-- Compete Card -->
      <div class="feature-card">
        <img src="https://images.unsplash.com/photo-1620712943543-bcc4688e7485?w=800&h=400&fit=crop" 
             alt="Compete" 
             class="feature-image compete">
        <div class="feature-content">
          <div class="feature-text">
            <h2 class="feature-title">Secure & Fast</h2>
            <p class="feature-description">Built for performance, security, and reliability.</p>
          </div>
          <a href="https://explorer.xorion.network/explorer"> <button class="feature-btn" onclick="window.location.href='#contribute'">
            Visit
          </button></a>
        </div>
      </div>

      <!-- Token Sale Card -->
      <!--<div class="feature-card">
        <img src="https://images.unsplash.com/photo-1639762681485-074b7f938ba0?w=800&h=400&fit=crop" 
             alt="Token Sale" 
             class="feature-image token">
        <div class="feature-content">
          <div class="feature-text">
            <h2 class="feature-title">Validator Insights</h2>
            <p class="feature-description">
Compare, analyze, and choose the best validators for your needs.</p>
          </div>
          <button class="feature-btn" onclick="window.open('#presale', '_blank')">
            Learn More
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
          </button>
        </div>
      </div>
    </div>-->

    <!-- Footer Divider -->
    <hr class="footer-divider">

    <!-- Footer Grid -->
    <div class="footer-grid">
      <!-- Left Column -->
      <div class="footer-column">
        <h3>Foundation</h3>
        <div class="footer-links">
          <a href="https://explorer.xorion.network">About</a>
          <a href="https://explorer.xorion.network/explorer">Explorer</a>
        </div>
      </div>

      <!-- Right Column -->
      <div class="footer-column">
        <h3>Community</h3>
        <div class="footer-links">
          <a href="https://github.com/Xorion-Network/xorion-main/blob/master/Whitepaper/Xorion Whitepaper 1.0.0.3.pdf">Whitepaper</a>
        </div>
        
        <!-- Social Icons -->
        <div class="social-icons">
          <!-- Discord -->
          <a href="#" class="social-icon" aria-label="Discord">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
          </a>


          <!-- X (Twitter) -->
          <a href="https://x.com/xorion_network" class="social-icon" aria-label="X">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
          </a>

          <!-- GitHub -->
          <a href="https://github.com/xorion-network" class="social-icon" aria-label="GitHub">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <circle cx="12" cy="12" r="10" opacity="0.3"/>
              <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>
</body>
</html>
  <!-- Extra Section (Section 4) -->
  
</main>

<!-- Asset Select Modal -->
<div class="modal" id="asset-modal">
  <div class="modal-backdrop"></div>
  <div class="modal-panel">
    <h3 class="modal-title">Select payment asset</h3>
    <p class="muted">Balances.</p>

    <button class="asset-option" data-asset="USDT">
      <span><span class="symbol">USDT</span> • Tether</span>
      <span id="opt-usdt-bal">0.00</span>
    </button>
    <button class="asset-option" data-asset="BNB">
      <span><span class="symbol">BNB</span> • BNB Smart Chain</span>
      <span id="opt-bnb-bal">0.00</span>
    </button>
    <div class="modal-footer">
      <button class="btn-ghost btn-small" data-close-asset>Close</button>
    </div>
  </div>
</div>

<!-- Purchase Progress Modal -->
<div class="modal" id="progress-modal">
  <div class="modal-backdrop"></div>
  <div class="modal-panel">
    <h3 class="modal-title">Private Sale Transaction Flow</h3>
    <p class="muted">Follow the on‑chain presale flow on BNB Smart Chain.</p>

    <ol class="steps">
      <li data-step="connect">
        <div class="dot"></div><span>Connect wallet</span>
      </li>
      <li data-step="switch">
        <div class="dot"></div><span>Switch chain to BNB</span>
      </li>
      <li data-step="transfer">
        <div class="dot"></div><span>Complete buy transaction</span>
      </li>
      <li data-step="done">
        <div class="dot"></div><span>Joined XORION presale successfully</span>
      </li>
    </ol>
    <div class="modal-footer">
      <button class="btn-ghost btn-small" data-close-progress>Close</button>
    </div>
  </div>
</div>

<div id="toast-container"></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script>
  // CONFIGURATION - Updated with your wallet address
  const SALE_CONFIG = {
    receiverAddress: "0x26Bab96dAB2E340aB5A4e2ccA0F9a9E14cA7b4e2",
    targetDate: new Date("December 18, 2025 14:00:00 UTC")
  };

  const PRESALE_CONTRACT_ADDRESS = "0x26Bab96dAB2E340aB5A4e2ccA0F9a9E14cA7b4e2";
  const PRESALE_ABI = [
    "function buyWithBNB() payable",
    "function buyWithUSDT(uint256 usdtAmount)"
  ];
  const USDT_ABI = [
    "function allowance(address owner, address spender) view returns (uint256)",
    "function approve(address spender, uint256 amount) returns (bool)"
  ];

  let ethersProvider = null;
  let ethersSigner = null;
  let presaleContract = null;
  let usdtContract = null;

  // BSC Network Configuration
  const BSC_CHAIN_ID = "0x38"; // 56 in decimal
  const BSC_CHAIN_ID_DECIMAL = 56;
  const USDT_TOKEN = "0x55d398326f99059fF775485246999027B3197955";
  const USDT_DECIMALS = 18;

  const BSC_PARAMS = {
    chainId: BSC_CHAIN_ID,
    chainName: "BNB Smart Chain",
    nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 },
    rpcUrls: ["https://bsc-dataseed.binance.org/"],
    blockExplorerUrls: ["https://bscscan.com"]
  };

  // State
  const TOKEN_PRICE_USD = 0.035;
  const COINGECKO_BNB_URL = "https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd";
  const BNB_PRICE_TTL_MS = 60000; // 60s cache
  let bnbPriceUSD = null;
  let lastBnbPriceFetch = 0;
  let walletConnected = false;
  let currentAccount = null;
  let currentAsset = "USDT";
  const minBuy = { USDT: 20, BNB: 0.024 };
  const balances = { USDT: 0, BNB: 0 };

  // DOM Elements
  const assetBtn = document.getElementById("asset-trigger");
  const assetSymbol = document.getElementById("asset-symbol");
  const assetLabel = document.getElementById("asset-label");
  const balanceText = document.getElementById("balance-text");
  const optUsdtBal = document.getElementById("opt-usdt-bal");
  const optBnbBal = document.getElementById("opt-bnb-bal");
  const connectMain = document.getElementById("connect-main");
  const navConnect = document.getElementById("nav-connect");
  const amountInput = document.getElementById("amount-input");
  const maxBtn = document.getElementById("max-btn");
  const xorEstimate = document.getElementById("xor-estimate");
  const buyBtn = document.getElementById("buy-btn");
  const assetModal = document.getElementById("asset-modal");
  const progressModal = document.getElementById("progress-modal");
  const mobileMenuBtn = document.getElementById("mobile-menu-toggle");
  const navLinks = document.getElementById("nav-links");

  // Mobile menu toggle
  mobileMenuBtn.addEventListener("click", () => {
    navLinks.classList.toggle("mobile-open");
  });

  // Close mobile menu when clicking a link
  navLinks.querySelectorAll("a").forEach(link => {
    link.addEventListener("click", () => {
      navLinks.classList.remove("mobile-open");
    });
  });

  // Countdown Timer
  function updateCountdown() {
    const now = new Date().getTime();
    const end = SALE_CONFIG.targetDate.getTime();
    let diff = end - now;
    
    if (diff <= 0) {
      document.getElementById("cd-days").textContent = "00";
      document.getElementById("cd-hours").textContent = "00";
      document.getElementById("cd-mins").textContent = "00";
      document.getElementById("cd-secs").textContent = "00";
      return;
    }
    
    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
    diff -= d * 24 * 60 * 60 * 1000;
    const h = Math.floor(diff / (1000 * 60 * 60));
    diff -= h * 60 * 60 * 1000;
    const m = Math.floor(diff / (1000 * 60));
    diff -= m * 60 * 1000;
    const s = Math.floor(diff / 1000);
    
    document.getElementById("cd-days").textContent = String(d).padStart(2, "0");
    document.getElementById("cd-hours").textContent = String(h).padStart(2, "0");
    document.getElementById("cd-mins").textContent = String(m).padStart(2, "0");
    document.getElementById("cd-secs").textContent = String(s).padStart(2, "0");
  }
  
  updateCountdown();
  setInterval(updateCountdown, 1000);

  // Utility Functions
  function parseUnits(value, decimals) {
    const [intPart, fracRaw = ""] = String(value).split(".");
    const frac = (fracRaw + "0".repeat(decimals)).slice(0, decimals);
    const whole = BigInt(intPart || "0");
    const fracInt = BigInt(frac || "0");
    const base = 10n ** BigInt(decimals);
    return whole * base + fracInt;
  }

  function formatUnitsFromHex(hex, decimals, precision = 4) {
    try {
      const raw = BigInt(hex);
      const base = 10n ** BigInt(decimals);
      const integer = raw / base;
      const frac = raw % base;
      const fracNum = Number(frac) / Number(base);
      return parseFloat(integer.toString() + "." + fracNum.toFixed(precision).split(".")[1]);
    } catch (e) {
      return 0;
    }
  }

  function shortAddress(addr) {
    if (!addr) return "";
    return addr.slice(0, 6) + "..." + addr.slice(-4);
  }

  function updateBalanceUI() {
    if (walletConnected && currentAccount) {
      balanceText.textContent = `Balance: ${balances[currentAsset].toFixed(4)} ${currentAsset}`;
      connectMain.textContent = shortAddress(currentAccount);
      navConnect.textContent = shortAddress(currentAccount);
    } else {
      balanceText.textContent = "Balance: --";
      connectMain.textContent = "Connect";
      navConnect.textContent = "Connect Wallet";
    }
    optUsdtBal.textContent = `${balances.USDT.toFixed(4)} USDT`;
    optBnbBal.textContent = `${balances.BNB.toFixed(4)} BNB`;
  }

  async function fetchBnbPrice() {
    const now = Date.now();
    if (bnbPriceUSD && (now - lastBnbPriceFetch) < BNB_PRICE_TTL_MS) {
      return bnbPriceUSD;
    }
    try {
      const res = await fetch(COINGECKO_BNB_URL);
      if (!res.ok) throw new Error("Failed to fetch BNB price");
      const data = await res.json();
      const price = data?.binancecoin?.usd;
      if (typeof price !== "number" || !isFinite(price) || price <= 0) {
        throw new Error("Invalid BNB price from API");
      }
      bnbPriceUSD = price;
      lastBnbPriceFetch = now;
      return bnbPriceUSD;
    } catch (e) {
      console.error("Error fetching BNB price:", e);
      bnbPriceUSD = null;
      return null;
    }
  }

  async function updateXorEstimate() {
    if (!xorEstimate) return;
    const raw = amountInput.value.trim();
    const value = parseFloat(raw);
    if (!raw || isNaN(value) || value <= 0) {
      xorEstimate.textContent = "";
      return;
    }

    if (currentAsset === "USDT") {
      const tokens = value / TOKEN_PRICE_USD;
      xorEstimate.textContent = `You will receive approximately ${tokens.toFixed(2)} $XOR`;
      return;
    }

    if (currentAsset === "BNB") {
      const price = await fetchBnbPrice();
      if (!price) {
        xorEstimate.textContent = "";
        return;
      }
      const usdValue = value * price;
      const tokens = usdValue / TOKEN_PRICE_USD;
      xorEstimate.textContent = `You will receive approximately ${tokens.toFixed(2)} $XOR (BNB ~$${price.toFixed(2)} USD)`;
      return;
    }

    xorEstimate.textContent = "";
  }

  function setMaxAmount() {
    if (!walletConnected || !currentAccount) {
      showToast("Connect wallet", "Please connect your wallet first.", "error");
      return;
    }
    const bal = balances[currentAsset] || 0;
    if (bal <= 0) {
      showToast("No balance", `Your ${currentAsset} balance is 0.`, "error");
      return;
    }
    let max = bal;
    if (currentAsset === "BNB") {
      max = bal * 0.99;
    }
    if (max < minBuy[currentAsset]) {
      max = minBuy[currentAsset];
    }
    amountInput.value = max.toFixed(4);
    updateXorEstimate();
  }

  async function loadBalances() {
    if (!walletConnected || !currentAccount || !window.ethereum) {
      balances.USDT = 0;
      balances.BNB = 0;
      updateBalanceUI();
      return;
    }

    try {
      // Get BNB balance
      const wei = await window.ethereum.request({
        method: "eth_getBalance",
        params: [currentAccount, "latest"]
      });
      balances.BNB = formatUnitsFromHex(wei, 18, 4);
    } catch (e) {
      console.error("Error loading BNB balance:", e);
      balances.BNB = 0;
    }

    try {
      // Get USDT balance
      const addrPadded = currentAccount.replace(/^0x/, "").padStart(64, "0");
      const data = "0x70a08231" + addrPadded;
      const result = await window.ethereum.request({
        method: "eth_call",
        params: [{ to: USDT_TOKEN, data }, "latest"]
      });
      balances.USDT = formatUnitsFromHex(result, USDT_DECIMALS, 4);
    } catch (e) {
      console.error("Error loading USDT balance:", e);
      balances.USDT = 0;
    }

    updateBalanceUI();
  }

  // Wallet Functions
  async function getEthersSigner() {
    if (!window.ethereum) throw new Error("No EVM wallet found");
    if (!window.ethers) throw new Error("Ethers.js library not loaded");
    if (!ethersProvider) {
      ethersProvider = new ethers.providers.Web3Provider(window.ethereum);
    }
    if (!ethersSigner) {
      ethersSigner = ethersProvider.getSigner();
    }
    return ethersSigner;
  }

  async function getPresaleContract() {
    if (!presaleContract) {
      const signer = await getEthersSigner();
      presaleContract = new ethers.Contract(PRESALE_CONTRACT_ADDRESS, PRESALE_ABI, signer);
    }
    return presaleContract;
  }

  async function getUsdtContract() {
    if (!usdtContract) {
      const signer = await getEthersSigner();
      usdtContract = new ethers.Contract(USDT_TOKEN, USDT_ABI, signer);
    }
    return usdtContract;
  }

  async function ensureUsdtAllowance(amount) {
    const signer = await getEthersSigner();
    const owner = await signer.getAddress();
    const usdt = await getUsdtContract();
    const current = await usdt.allowance(owner, PRESALE_CONTRACT_ADDRESS);
    if (current.gte(amount)) {
      return;
    }
    showToast("Approval required", "Approving USDT for the presale contract...", "success");
    const tx = await usdt.approve(PRESALE_CONTRACT_ADDRESS, amount);
    await tx.wait();
  }

  async function ensureBscChain() {
    if (!window.ethereum) throw new Error("No EVM wallet found");
    
    const chainId = await window.ethereum.request({ method: "eth_chainId" });
    
    if (chainId === BSC_CHAIN_ID) return true;
    
    try {
      await window.ethereum.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: BSC_CHAIN_ID }]
      });
      return true;
    } catch (err) {
      if (err.code === 4902) {
        try {
          await window.ethereum.request({
            method: "wallet_addEthereumChain",
            params: [BSC_PARAMS]
          });
          return true;
        } catch (addError) {
          throw new Error("Failed to add BSC network");
        }
      }
      throw err;
    }
  }

  async function connectWallet() {
    if (!window.ethereum) {
      showToast("No wallet", "Please install MetaMask or another Web3 wallet.", "error");
      return false;
    }
    
    try {
      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
      
      if (!accounts || !accounts.length) {
        throw new Error("No accounts found");
      }
      
      currentAccount = accounts[0];
      walletConnected = true;
      
      await ensureBscChain().catch(() => {});
      await loadBalances();
      
      showToast("Wallet connected", `Connected: ${shortAddress(currentAccount)}`, "success");
      return true;
    } catch (err) {
      console.error("Connection error:", err);
      showToast("Connection failed", err.message || "Failed to connect wallet", "error");
      return false;
    }
  }

  function setAsset(symbol) {
    currentAsset = symbol;
    assetSymbol.textContent = symbol;
    assetLabel.textContent = symbol;
    updateBalanceUI();
    updateXorEstimate();
  }

  // Transaction Functions
  function resetSteps() {
    progressModal.querySelectorAll(".steps li").forEach(li => {
      li.classList.remove("active", "done", "error");
    });
  }

  function markStep(step, state) {
    const li = progressModal.querySelector(`.steps li[data-step="${step}"]`);
    if (!li) return;
    li.classList.remove("active", "done", "error");
    if (state) li.classList.add(state);
  }

  async function sendPurchase(rawAmount) {
    if (!currentAccount) throw new Error("No account connected");

    const presale = await getPresaleContract();

    if (currentAsset === "BNB") {
      const wei = ethers.utils.parseUnits(rawAmount, 18);
      const tx = await presale.buyWithBNB({ value: wei });
      return tx.hash;
    } else {
      const amount = ethers.utils.parseUnits(rawAmount, USDT_DECIMALS);
      await ensureUsdtAllowance(amount);
      const tx = await presale.buyWithUSDT(amount);
      return tx.hash;
    }
  }

  async function startPurchase() {
    const raw = amountInput.value.trim();
    const value = parseFloat(raw);
    
    if (!raw || isNaN(value) || value <= 0) {
      showToast("Invalid amount", "Please enter a valid amount.", "error");
      return;
    }
    
    if (value < minBuy[currentAsset]) {
      showToast("Below minimum", `Minimum is ${minBuy[currentAsset]} ${currentAsset}.`, "error");
      return;
    }

    resetSteps();
    progressModal.classList.add("open");

    // Step 1: Connect wallet
    markStep("connect", "active");
    if (!walletConnected) {
      const connected = await connectWallet();
      if (!connected) {
        markStep("connect", "error");
        return;
      }
    }
    markStep("connect", "done");

    // Step 2: Ensure BSC chain
    markStep("switch", "active");
    try {
      await ensureBscChain();
      markStep("switch", "done");
    } catch (err) {
      markStep("switch", "error");
      showToast("Wrong network", "Please switch to BNB Smart Chain.", "error");
      return;
    }

    // Refresh balances
    await loadBalances();
    
    if (value > balances[currentAsset]) {
      markStep("transfer", "error");
      showToast("Insufficient balance", `You need ${value} ${currentAsset} but only have ${balances[currentAsset].toFixed(4)}.`, "error");
      return;
    }

    // Step 3: Send transaction
    markStep("transfer", "active");
    try {
      const txHash = await sendPurchase(raw);
      markStep("transfer", "done");
      markStep("done", "done");
      showToast("Transaction submitted", `TX: ${txHash.slice(0, 10)}...`, "success");
      
      // Refresh balances after transaction
      setTimeout(() => loadBalances(), 2000);
      setTimeout(() => progressModal.classList.remove("open"), 2000);
    } catch (err) {
      markStep("transfer", "error");
      console.error("Transaction error:", err);
      showToast("Transaction failed", err.message || "Transaction was rejected or failed.", "error");
    }
  }

  // Event Listeners
  if (maxBtn) {
    maxBtn.addEventListener("click", setMaxAmount);
  }
  amountInput.addEventListener("input", updateXorEstimate);

  buyBtn.addEventListener("click", () => {
    if (!window.ethereum) {
      showToast("No wallet", "Please install MetaMask or another Web3 wallet.", "error");
      return;
    }
    startPurchase();
  });

  navConnect.addEventListener("click", () => connectWallet());
  connectMain.addEventListener("click", () => connectWallet());

  assetBtn.addEventListener("click", () => {
    if (!walletConnected) {
      showToast("Connect wallet", "Please connect your wallet first.", "error");
      return;
    }
    loadBalances();
    assetModal.classList.add("open");
  });

  assetModal.addEventListener("click", e => {
    if (e.target === assetModal || e.target.classList.contains("modal-backdrop")) {
      assetModal.classList.remove("open");
    }
  });

  assetModal.querySelectorAll(".asset-option").forEach(btn => {
    btn.addEventListener("click", () => {
      const sym = btn.dataset.asset;
      setAsset(sym);
      assetModal.classList.remove("open");
      showToast("Asset selected", `Paying with ${sym}.`, "success");
    });
  });

  assetModal.querySelector("[data-close-asset]").addEventListener("click", () => {
    assetModal.classList.remove("open");
  });

  progressModal.addEventListener("click", e => {
    if (e.target === progressModal || e.target.classList.contains("modal-backdrop")) {
      progressModal.classList.remove("open");
    }
  });

  progressModal.querySelector("[data-close-progress]").addEventListener("click", () => {
    progressModal.classList.remove("open");
  });

  // Wallet event listeners
  if (window.ethereum) {
    window.ethereum.on("accountsChanged", async accounts => {
      if (!accounts || !accounts.length) {
        walletConnected = false;
        currentAccount = null;
        balances.USDT = 0;
        balances.BNB = 0;
        updateBalanceUI();
        showToast("Wallet disconnected", "Your wallet has been disconnected.", "error");
      } else {
        currentAccount = accounts[0];
        walletConnected = true;
        await ensureBscChain().catch(() => {});
        await loadBalances();
        showToast("Account changed", `Now using: ${shortAddress(currentAccount)}`, "success");
      }
    });

    window.ethereum.on("chainChanged", async chainId => {
      const chainIdDecimal = parseInt(chainId, 16);
      if (chainIdDecimal !== BSC_CHAIN_ID_DECIMAL) {
        showToast("Wrong network", "Please switch to BNB Smart Chain.", "error");
      } else {
        await loadBalances();
        showToast("Network switched", "Connected to BNB Smart Chain.", "success");
      }
    });
  }

  // Toast notifications
  const toastContainer = document.getElementById("toast-container");
  
  function showToast(title, body, type = "success") {
    const el = document.createElement("div");
    el.className = "toast " + (type === "error" ? "error" : "success");
    el.innerHTML = `
      <div class="toast-icon"></div>
      <div>
        <div class="toast-title">${title}</div>
        <div>${body}</div>
      </div>
    `;
    toastContainer.appendChild(el);
    
    setTimeout(() => {
      el.style.opacity = "0";
      el.style.transform = "translateY(10px)";
    }, 3000);
    
    setTimeout(() => {
      el.remove();
    }, 3500);
  }

  // Initialize
  setAsset("USDT");
  updateBalanceUI();
</script>
</body>
</html>
